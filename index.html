<!doctype html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PeakOS - Browser Environment</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M50 10 L70 50 L90 90 L10 90 L30 50 Z' fill='%2300d4ff'/><path d='M50 10 L60 30 L50 35 L40 30 Z' fill='%23fff'/></svg>" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;500;700&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        :root {
            --bg: #0a0e27; --bg2: #151b3d; --bg3: #1e2749;
            --acc: #00d4ff; --txt: #e8eaf0; --txt2: #8b93b8;
            --border: rgba(255,255,255,0.08); --border-acc: rgba(0,212,255,0.25);
            --glow: rgba(0,212,255,0.15);
        }
        
        /* ‚ïê‚ïê‚ïê THEME PRESETS ‚ïê‚ïê‚ïê */
        body.theme-midnight { 
            --bg: #0a0e27; --bg2: #151b3d; --bg3: #1e2749;
            --acc: #00d4ff; --glow: rgba(0,212,255,0.15); 
        }
        body.theme-sunset { 
            --bg: #1a0e0a; --bg2: #2d1810; --bg3: #3d2318;
            --acc: #ff6b35; --glow: rgba(255,107,53,0.15); 
        }
        body.theme-forest { 
            --bg: #0a1a0e; --bg2: #142d1a; --bg3: #1e3d27;
            --acc: #00ff88; --glow: rgba(0,255,136,0.15); 
        }
        body.theme-royal { 
            --bg: #140a1a; --bg2: #251a2d; --bg3: #351e3d;
            --acc: #a855f7; --glow: rgba(168,85,247,0.15); 
        }
        body.theme-cyberpunk { 
            --bg: #0d0d1a; --bg2: #1a1a2d; --bg3: #272740;
            --acc: #ff00ff; --glow: rgba(255,0,255,0.15); 
        }
        body.theme-ocean { 
            --bg: #0a141a; --bg2: #10252d; --bg3: #18353d;
            --acc: #00bfff; --glow: rgba(0,191,255,0.15); 
        }
        
        body.high-contrast { --bg: #000; --bg2: #0a0a0a; --bg3: #1a1a1a; --txt: #fff; --border: rgba(255,255,255,0.3); }
        body.reduced-motion * { animation: none !important; transition: none !important; }
        body.performance-mode #desktop-bg { display: none; }
        body.font-large { font-size: 18px; }
        
        html, body { width: 100%; height: 100%; font-family: 'Roboto',sans-serif; overflow: hidden; }
        body { background: var(--bg); color: var(--txt); }
        body.unlocked { cursor: none; }
        
        /* ‚ïê‚ïê‚ïê CUSTOM CURSOR ‚ïê‚ïê‚ïê */
        #cursor { position: fixed; left: 0; top: 0; pointer-events: none; z-index: 999999;
            transform: translate(-2px,-2px); display: none; }
        body.unlocked #cursor { display: block; }
        .c-main { width: 20px; height: 20px; position: relative; }
        .c-pointer { width: 0; height: 0; border-left: 7px solid transparent; border-right: 7px solid transparent;
            border-bottom: 11px solid var(--acc); transform: rotate(-45deg); position: absolute;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); transition: transform .1s; }
        .c-ring { width: 26px; height: 26px; border-radius: 50%; border: 2px solid var(--acc);
            position: absolute; top: -3px; left: -3px; opacity: 0.3; transition: all .15s ease-out; }
        #cursor.hover .c-ring { transform: scale(1.5); opacity: 0.6; }
        #cursor.click .c-pointer { transform: rotate(-45deg) scale(0.85); }
        
        /* ‚ïê‚ïê‚ïê BACKGROUND SYSTEM ‚ïê‚ïê‚ïê */
        #desktop-bg { position: fixed; inset: 0; z-index: 0; transition: background .5s; }
        #desktop-bg.bg-gradient-1 { background: linear-gradient(135deg, #0a0e27 0%, #1e2749 100%); }
        #desktop-bg.bg-gradient-2 { background: linear-gradient(135deg, #1a0e0a 0%, #3d2318 100%); }
        #desktop-bg.bg-gradient-3 { background: linear-gradient(135deg, #0a1a0e 0%, #1e3d27 100%); }
        #desktop-bg.bg-gradient-4 { background: linear-gradient(135deg, #140a1a 0%, #351e3d 100%); }
        #desktop-bg.bg-stars { background: #000 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><circle cx="20" cy="30" r="1" fill="white" opacity="0.8"/><circle cx="180" cy="50" r="1.5" fill="white" opacity="0.6"/><circle cx="90" cy="80" r="1" fill="white" opacity="0.9"/><circle cx="140" cy="120" r="1" fill="white" opacity="0.7"/><circle cx="50" cy="150" r="1.5" fill="white" opacity="0.8"/><circle cx="170" cy="170" r="1" fill="white" opacity="0.6"/></svg>'); }
        #desktop-bg.bg-mesh { background: radial-gradient(circle at 20% 50%, rgba(0,212,255,0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, rgba(168,85,247,0.1) 0%, transparent 50%),
            var(--bg); }
        #desktop-bg.bg-custom { background-size: cover; background-position: center; }
        
        .bg-logo-watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            opacity: 0.03; pointer-events: none; }
        .bg-logo-watermark svg { width: 400px; height: 400px; }
        
        #bg-canvas { position: absolute; inset: 0; }
        .desktop-pattern { position: absolute; inset: 0; opacity: .05;
            background: repeating-linear-gradient(45deg, transparent, transparent 20px, var(--acc) 20px, var(--acc) 21px); }
        
        /* ‚ïê‚ïê‚ïê DISGUISE ‚ïê‚ïê‚ïê */
        #disguise { position: fixed; inset: 0; z-index: 99999; background: #f5f7fa; 
            overflow-y: auto; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
            transition: opacity .5s, transform .5s; cursor: default; }
        #disguise.hide { opacity: 0; transform: scale(1.02); pointer-events: none; }
        body.unlocked #disguise { display: none; }
        
        .edu-wrap { max-width: 1100px; margin: 0 auto; padding: 40px 24px 80px; }
        .edu-header { background: #fff; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,.08);
            padding: 24px 28px; display: flex; align-items: center; gap: 20px; margin-bottom: 24px;
            border: 1px solid #e5e7eb; }
        .edu-logo { width: 64px; height: 64px; border-radius: 14px; background: linear-gradient(135deg,#2563eb,#1d4ed8);
            color: #fff; display: flex; align-items: center; justify-content: center; font-size: 28px;
            font-weight: 700; box-shadow: 0 4px 12px rgba(37,99,235,.25); }
        .edu-brand h1 { font-size: 28px; color: #1e293b; font-weight: 700; letter-spacing: -0.02em; }
        .edu-brand p { color: #64748b; font-size: 14px; margin-top: 6px; }
        
        .edu-hero { background: linear-gradient(135deg,#eff6ff,#f8fafc); border: 1px solid #e0e7ff;
            border-radius: 16px; padding: 28px; margin-bottom: 24px; display: grid;
            grid-template-columns: 2fr 1fr; gap: 24px; }
        .edu-hero h2 { color: #1e293b; font-size: 24px; margin-bottom: 10px; font-weight: 700; }
        .edu-hero p { color: #64748b; font-size: 15px; line-height: 1.7; }
        
        #unlock-trigger { background: linear-gradient(135deg,#3b82f6,#2563eb); 
            border: none; border-radius: 12px; padding: 18px 24px; cursor: pointer;
            transition: all .25s; color: #fff; font-weight: 600; font-size: 15px;
            box-shadow: 0 4px 12px rgba(37,99,235,.3); }
        #unlock-trigger:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(37,99,235,.4); }
        #unlock-trigger .unlock-status { font-size: 12px; opacity: .9; margin-top: 4px; }
        
        /* ‚ïê‚ïê‚ïê OS DESKTOP ‚ïê‚ïê‚ïê */
        #os { position: fixed; inset: 0; display: flex; flex-direction: column; opacity: 0;
            transition: opacity .6s; pointer-events: none; }
        body.unlocked #os { opacity: 1; pointer-events: auto; }
        
        #desktop { position: relative; z-index: 1; flex: 1; padding: 20px; overflow: hidden; }
        
        .desktop-icons { display: grid; grid-template-columns: repeat(auto-fill,100px);
            gap: 20px; grid-auto-rows: 100px; }
        .desktop-icon { display: flex; flex-direction: column; align-items: center; gap: 8px;
            padding: 10px; border-radius: 12px; cursor: pointer; transition: all .2s;
            background: transparent; border: 2px solid transparent; }
        .desktop-icon:hover { background: rgba(255,255,255,.05); border-color: var(--border-acc); }
        .desktop-icon-img { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; }
        .desktop-icon-img svg { width: 100%; height: 100%; }
        .desktop-icon-label { font-size: 12px; color: var(--txt); text-align: center;
            text-shadow: 0 1px 3px rgba(0,0,0,.8); font-weight: 500; }
        
        /* ‚ïê‚ïê‚ïê WINDOWS (BROWSER-STYLE TABS) ‚ïê‚ïê‚ïê */
        .window { position: fixed; background: var(--bg2); border: 1px solid var(--border-acc);
            border-radius: 12px 12px 0 0; box-shadow: 0 20px 60px rgba(0,0,0,.7);
            display: flex; flex-direction: column; opacity: 0; pointer-events: none;
            transition: opacity .2s; min-width: 500px; min-height: 400px; resize: both; overflow: auto; }
        .window.show { opacity: 1; pointer-events: auto; z-index: 100; }
        .window.maximized { top: 0 !important; left: 0 !important; right: 0 !important; bottom: 56px !important;
            width: 100% !important; height: calc(100% - 56px) !important; border-radius: 0; resize: none; }
        .window.minimized { opacity: 0; pointer-events: none; transform: scale(0.8) translateY(100vh); }
        
        /* Window Tabs */
        .window-tabs { display: flex; background: var(--bg3); border-bottom: 1px solid var(--border);
            overflow-x: auto; }
        .window-tabs::-webkit-scrollbar { height: 0; }
        .window-tab { display: flex; align-items: center; gap: 8px; padding: 10px 16px;
            background: transparent; border-right: 1px solid var(--border); cursor: pointer;
            transition: all .15s; min-width: 180px; max-width: 250px; position: relative; }
        .window-tab:hover { background: rgba(255,255,255,.03); }
        .window-tab.active { background: var(--bg2); }
        .window-tab-icon { font-size: 14px; flex-shrink: 0; }
        .window-tab-title { flex: 1; font-size: 12px; overflow: hidden; text-overflow: ellipsis;
            white-space: nowrap; color: var(--txt2); }
        .window-tab.active .window-tab-title { color: var(--txt); font-weight: 500; }
        .window-tab-close { font-size: 16px; opacity: 0; color: var(--txt2); padding: 2px 4px;
            border-radius: 4px; transition: all .15s; }
        .window-tab:hover .window-tab-close { opacity: 1; }
        .window-tab-close:hover { background: rgba(255,255,255,.1); color: var(--txt); }
        .window-tab-new { padding: 10px 16px; background: transparent; border: none;
            color: var(--txt2); cursor: pointer; font-size: 18px; transition: all .15s; }
        .window-tab-new:hover { background: rgba(255,255,255,.05); color: var(--txt); }
        
        /* Window Title Bar */
        .window-titlebar { display: flex; align-items: center; gap: 10px; padding: 8px 12px;
            background: var(--bg3); border-bottom: 1px solid var(--border); cursor: move; }
        .window.maximized .window-titlebar { cursor: default; }
        .window-title { flex: 1; font-size: 13px; font-weight: 500; color: var(--txt2); }
        .window-controls { display: flex; gap: 6px; }
        .window-btn { width: 28px; height: 28px; border-radius: 6px; background: transparent;
            border: 1px solid var(--border); color: var(--txt2); cursor: pointer; font-size: 13px;
            display: flex; align-items: center; justify-content: center; transition: all .15s; }
        .window-btn:hover { background: rgba(255,255,255,.08); color: var(--txt); }
        .window-btn.close:hover { background: #ef4444; color: #fff; border-color: #ef4444; }
        
        /* Tab Content */
        .tab-content { display: none; flex: 1; overflow: hidden; position: relative; }
        .tab-content.active { display: flex; flex-direction: column; }
        
        /* Iframe Content */
        .content-frame { flex: 1; background: #000; position: relative; }
        .content-frame iframe { width: 100%; height: 100%; border: none; }
        
        .frame-loading { position: absolute; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; gap: 16px; background: #000;
            z-index: 10; transition: opacity .3s; }
        .frame-loading.hide { opacity: 0; pointer-events: none; }
        .loading-spinner { width: 48px; height: 48px; border: 4px solid var(--bg3);
            border-top-color: var(--acc); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 13px; color: var(--txt2); font-family: 'Fira Code',monospace; }
        
        .frame-error { display: none; flex-direction: column; align-items: center;
            justify-content: center; gap: 16px; padding: 40px; text-align: center; }
        .frame-error.show { display: flex; }
        .error-icon { font-size: 64px; }
        .error-title { font-size: 18px; font-weight: 700; color: var(--txt); }
        .error-msg { font-size: 13px; color: var(--txt2); }
        .error-btn { padding: 10px 24px; background: var(--acc); color: var(--bg); border: none;
            border-radius: 8px; font-weight: 600; cursor: pointer; transition: all .2s; }
        .error-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--glow); }
        
        /* Grid Content (for Proxy Hub & Games) */
        .content-grid { flex: 1; overflow-y: auto; padding: 24px; }
        .content-grid::-webkit-scrollbar { width: 8px; }
        .content-grid::-webkit-scrollbar-thumb { background: var(--border-acc); border-radius: 4px; }
        
        .grid-header { margin-bottom: 24px; }
        .grid-title { font-size: 24px; font-weight: 700; color: var(--txt);
            font-family: 'Orbitron',sans-serif; }
        .grid-subtitle { font-size: 13px; color: var(--txt2); margin-top: 6px; }
        
        .item-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap: 14px; }
        .item-card { background: var(--bg3); border: 1px solid var(--border); border-radius: 12px;
            padding: 18px; cursor: pointer; transition: all .2s; display: flex;
            flex-direction: column; gap: 10px; }
        .item-card:hover { border-color: var(--border-acc); transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,.4); }
        .item-icon { font-size: 32px; }
        .item-name { font-size: 14px; font-weight: 600; color: var(--txt); }
        .item-desc { font-size: 12px; color: var(--txt2); }
        
        /* Search Results */
        .search-results { position: absolute; top: 100%; left: 0; right: 0; max-height: 400px;
            overflow-y: auto; background: var(--bg2); border: 1px solid var(--border-acc);
            border-radius: 0 0 12px 12px; box-shadow: 0 8px 32px rgba(0,0,0,.6);
            display: none; z-index: 999; }
        .search-results.show { display: block; }
        .search-result-item { padding: 12px 16px; display: flex; align-items: center; gap: 12px;
            cursor: pointer; transition: all .15s; border-bottom: 1px solid var(--border); }
        .search-result-item:hover { background: var(--glow); }
        .search-result-item:last-child { border-bottom: none; }
        .search-result-icon { font-size: 24px; }
        .search-result-content { flex: 1; }
        .search-result-title { font-size: 13px; font-weight: 600; color: var(--txt); }
        .search-result-type { font-size: 11px; color: var(--txt2); margin-top: 2px; }
        
        /* Styles App Content */
        .styles-content { flex: 1; overflow-y: auto; padding: 24px; }
        .styles-section { margin-bottom: 32px; }
        .styles-section-title { font-size: 13px; font-weight: 700; text-transform: uppercase;
            letter-spacing: .1em; color: var(--txt2); margin-bottom: 16px;
            padding-bottom: 8px; border-bottom: 1px solid var(--border); }
        
        .theme-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(150px,1fr)); gap: 14px; }
        .theme-card { aspect-ratio: 16/9; border-radius: 12px; cursor: pointer; position: relative;
            overflow: hidden; border: 2px solid var(--border); transition: all .2s; }
        .theme-card.active { border-color: var(--acc); box-shadow: 0 0 0 3px var(--glow); }
        .theme-card:hover { transform: scale(1.05); }
        .theme-card-preview { width: 100%; height: 100%; display: flex; align-items: center;
            justify-content: center; font-size: 32px; }
        .theme-card-name { position: absolute; bottom: 8px; left: 8px; right: 8px;
            background: rgba(0,0,0,.8); backdrop-filter: blur(10px); border-radius: 6px;
            padding: 6px 10px; font-size: 11px; font-weight: 600; text-align: center; }
        
        .bg-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap: 14px; }
        .bg-card { aspect-ratio: 16/9; border-radius: 12px; cursor: pointer; position: relative;
            overflow: hidden; border: 2px solid var(--border); transition: all .2s; }
        .bg-card.active { border-color: var(--acc); box-shadow: 0 0 0 3px var(--glow); }
        .bg-card:hover { transform: scale(1.05); }
        .bg-card-preview { width: 100%; height: 100%; }
        .bg-card-name { position: absolute; bottom: 8px; left: 8px; right: 8px;
            background: rgba(0,0,0,.8); backdrop-filter: blur(10px); border-radius: 6px;
            padding: 6px 10px; font-size: 11px; font-weight: 600; text-align: center; }
        
        .custom-bg-upload { padding: 24px; background: var(--bg3); border: 2px dashed var(--border);
            border-radius: 12px; text-align: center; cursor: pointer; transition: all .2s; }
        .custom-bg-upload:hover { border-color: var(--border-acc); background: var(--glow); }
        .custom-bg-upload input { display: none; }
        .upload-icon { font-size: 48px; margin-bottom: 12px; }
        .upload-text { font-size: 14px; font-weight: 600; color: var(--txt); }
        .upload-hint { font-size: 12px; color: var(--txt2); margin-top: 6px; }
        
        /* ‚ïê‚ïê‚ïê TASKBAR ‚ïê‚ïê‚ïê */
        #taskbar { position: fixed; bottom: 0; left: 0; right: 0; height: 56px; z-index: 200;
            background: rgba(21,27,61,.95); backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-acc); display: flex; align-items: center;
            padding: 0 16px; gap: 12px; box-shadow: 0 -4px 20px rgba(0,0,0,.3); }
        
        .taskbar-start { display: flex; align-items: center; gap: 12px; }
        .start-btn { width: 48px; height: 48px; border-radius: 12px;
            background: transparent; border: 1px solid var(--border-acc); cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: all .2s; }
        .start-btn:hover { background: var(--glow); box-shadow: 0 4px 12px var(--glow); }
        .start-btn svg { width: 28px; height: 28px; }
        
        .search-taskbar { flex: 1; max-width: 500px; background: var(--bg3);
            border: 1px solid var(--border); border-radius: 24px; padding: 10px 20px;
            display: flex; align-items: center; gap: 10px; transition: all .2s; position: relative; }
        .search-taskbar:focus-within { border-color: var(--border-acc); box-shadow: 0 0 0 3px var(--glow); }
        .search-taskbar input { flex: 1; background: transparent; border: none; outline: none;
            color: var(--txt); font-size: 14px; }
        .search-taskbar input::placeholder { color: var(--txt2); }
        
        .taskbar-windows { display: flex; gap: 6px; flex: 1; overflow-x: auto; }
        .taskbar-windows::-webkit-scrollbar { height: 0; }
        .taskbar-window-btn { padding: 8px 16px; background: var(--bg3); border: 1px solid var(--border);
            border-radius: 8px; cursor: pointer; transition: all .15s; display: flex;
            align-items: center; gap: 8px; min-width: 150px; max-width: 200px; }
        .taskbar-window-btn:hover { background: rgba(255,255,255,.05); }
        .taskbar-window-btn.active { background: var(--glow); border-color: var(--border-acc); }
        .taskbar-window-icon { font-size: 16px; }
        .taskbar-window-title { flex: 1; font-size: 12px; font-weight: 500; overflow: hidden;
            text-overflow: ellipsis; white-space: nowrap; color: var(--txt2); }
        .taskbar-window-btn.active .taskbar-window-title { color: var(--txt); }
        
        .taskbar-end { display: flex; align-items: center; gap: 12px; margin-left: auto; }
        .taskbar-icon { width: 40px; height: 40px; border-radius: 10px; background: transparent;
            border: 1px solid transparent; cursor: pointer; display: flex; align-items: center;
            justify-content: center; transition: all .15s; color: var(--txt2); }
        .taskbar-icon:hover { background: rgba(255,255,255,.08); color: var(--txt); }
        
        .taskbar-clock { padding: 8px 16px; text-align: center; cursor: pointer;
            border-radius: 8px; transition: all .15s; }
        .taskbar-clock:hover { background: rgba(255,255,255,.05); }
        .clock-time { font-size: 14px; font-weight: 600; color: var(--txt);
            font-family: 'Fira Code',monospace; }
        .clock-date { font-size: 11px; color: var(--txt2); margin-top: 2px; }
        
        /* ‚ïê‚ïê‚ïê START MENU ‚ïê‚ïê‚ïê */
        #start-menu { position: fixed; bottom: 72px; left: 16px; width: 650px; height: 700px;
            background: var(--bg2); border: 1px solid var(--border-acc); border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,.8); display: flex; flex-direction: column;
            opacity: 0; pointer-events: none; transition: all .25s; transform: translateY(20px); }
        #start-menu.show { opacity: 1; pointer-events: auto; transform: translateY(0); z-index: 199; }
        
        .start-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex;
            align-items: center; gap: 16px; }
        .start-logo { width: 48px; height: 48px; }
        .start-logo svg { width: 100%; height: 100%; }
        .start-brand { flex: 1; }
        .start-title { font-size: 24px; font-weight: 700; font-family: 'Orbitron',sans-serif;
            background: linear-gradient(135deg,var(--acc),rgba(0,212,255,0.6));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .start-subtitle { font-size: 12px; color: var(--txt2); margin-top: 4px; }
        
        .start-content { flex: 1; overflow-y: auto; padding: 20px; }
        .start-section { margin-bottom: 28px; }
        .start-section-title { font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: .1em; color: var(--txt2); margin-bottom: 12px; }
        
        .start-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 12px; }
        .start-item { background: var(--bg3); border: 1px solid var(--border); border-radius: 12px;
            padding: 20px 12px; cursor: pointer; transition: all .2s; display: flex;
            flex-direction: column; align-items: center; gap: 8px; }
        .start-item:hover { background: var(--glow); border-color: var(--border-acc);
            transform: translateY(-2px); }
        .start-item-icon { font-size: 28px; }
        .start-item-label { font-size: 11px; font-weight: 600; text-align: center; color: var(--txt); }
        
        /* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
        .toast { position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: var(--bg2); border: 1px solid var(--border-acc); border-radius: 12px;
            padding: 16px 20px; min-width: 280px; box-shadow: 0 8px 32px rgba(0,0,0,.6);
            transform: translateX(400px); transition: transform .3s; display: flex;
            align-items: center; gap: 12px; }
        .toast.show { transform: translateX(0); }
        .toast-icon { font-size: 24px; }
        .toast-content { flex: 1; }
        .toast-title { font-size: 13px; font-weight: 600; color: var(--txt); }
        .toast-msg { font-size: 12px; color: var(--txt2); margin-top: 2px; }
        .toast.success { border-color: rgba(34,197,94,.4); }
        .toast.error { border-color: rgba(239,68,68,.4); }
        
        /* ‚ïê‚ïê‚ïê CONTEXT MENU ‚ïê‚ïê‚ïê */
        #context-menu { position: fixed; min-width: 200px; background: var(--bg2);
            border: 1px solid var(--border-acc); border-radius: 12px; padding: 8px;
            box-shadow: 0 12px 40px rgba(0,0,0,.7); opacity: 0; pointer-events: none;
            transition: opacity .15s; z-index: 9998; }
        #context-menu.show { opacity: 1; pointer-events: auto; }
        .context-item { padding: 10px 14px; border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; gap: 12px; font-size: 13px;
            color: var(--txt); transition: all .12s; }
        .context-item:hover { background: var(--glow); }
        .context-icon { font-size: 16px; width: 20px; text-align: center; }
        
        @media(max-width:768px) {
            #start-menu { width: calc(100% - 32px); height: 80vh; }
            .start-grid { grid-template-columns: repeat(3,1fr); }
        }
    </style>
</head>
<body class="theme-midnight">

    <!-- CUSTOM CURSOR -->
    <div id="cursor">
        <div class="c-main">
            <div class="c-pointer"></div>
            <div class="c-ring"></div>
        </div>
    </div>

    <!-- DISGUISE -->
    <div id="disguise">
        <div class="edu-wrap">
            <div class="edu-header">
                <div class="edu-logo">HS</div>
                <div class="edu-brand">
                    <h1>Hillside Secondary School</h1>
                    <p>Student Academic Portal ‚Ä¢ Hillside District</p>
                </div>
            </div>
            
            <section class="edu-hero">
                <div>
                    <h2>Welcome Back, Student!</h2>
                    <p>Access your classes, view assignments, and connect with teachers through our integrated learning platform.</p>
                </div>
                <div>
                    <button id="unlock-trigger">
                        üîì Initialize Session
                        <div class="unlock-status" id="unlock-status">Click 3 times to unlock</div>
                    </button>
                </div>
            </section>
        </div>
    </div>

    <!-- OS ENVIRONMENT -->
    <div id="os">
        <!-- Desktop Background -->
        <div id="desktop-bg" class="bg-gradient-1">
            <canvas id="bg-canvas"></canvas>
            <div class="desktop-pattern"></div>
            <div class="bg-logo-watermark">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path d="M 20 90 L 40 50 L 50 60 L 60 40 L 80 90 Z" fill="currentColor" opacity="1"/>
                    <path d="M 50 25 L 60 40 L 50 45 L 40 40 Z" fill="currentColor" opacity="0.8"/>
                </svg>
            </div>
        </div>
        
        <!-- Desktop Area -->
        <div id="desktop">
            <div class="desktop-icons">
                <!-- ADDED DASHBOARD ICON -->
                <div class="desktop-icon" data-app="dashboard">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect x="15" y="15" width="20" height="20" rx="3" fill="currentColor"/>
                            <rect x="45" y="15" width="20" height="20" rx="3" fill="currentColor"/>
                            <rect x="75" y="15" width="20" height="20" rx="3" fill="currentColor"/>
                            <rect x="15" y="45" width="20" height="40" rx="3" fill="currentColor"/>
                            <rect x="45" y="45" width="20" height="40" rx="3" fill="currentColor"/>
                            <rect x="75" y="45" width="20" height="40" rx="3" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Dashboard</div>
                </div>
                <div class="desktop-icon" data-app="hub">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" stroke-width="4"/>
                            <circle cx="50" cy="50" r="8" fill="currentColor"/>
                            <line x1="50" y1="50" x2="50" y2="15" stroke="currentColor" stroke-width="3"/>
                            <line x1="50" y1="50" x2="85" y2="50" stroke="currentColor" stroke-width="3"/>
                            <line x1="50" y1="50" x2="50" y2="85" stroke="currentColor" stroke-width="3"/>
                            <line x1="50" y1="50" x2="15" y2="50" stroke="currentColor" stroke-width="3"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Proxy Hub</div>
                </div>
                <div class="desktop-icon" data-app="games">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <rect x="15" y="30" width="70" height="40" rx="8" fill="none" stroke="currentColor" stroke-width="4"/>
                            <circle cx="35" cy="50" r="6" fill="currentColor"/>
                            <circle cx="65" cy="45" r="4" fill="currentColor"/>
                            <circle cx="75" cy="55" r="4" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Games</div>
                </div>
                <div class="desktop-icon" data-app="styles">
                    <div class="desktop-icon-img">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="35" r="15" fill="none" stroke="currentColor" stroke-width="4"/>
                            <path d="M 35 45 Q 25 60 30 75 L 70 75 Q 75 60 65 45" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="desktop-icon-label">Styles</div>
                </div>
            </div>
        </div>
        
        <!-- Window Container -->
        <div id="windows-container"></div>
        
        <!-- Start Menu -->
        <div id="start-menu">
            <div class="start-header">
                <div class="start-logo">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:var(--acc);stop-opacity:1" />
                                <stop offset="100%" style="stop-color:var(--acc);stop-opacity:0.6" />
                            </linearGradient>
                        </defs>
                        <path d="M 20 90 L 40 50 L 50 60 L 60 40 L 80 90 Z" fill="url(#logoGrad)"/>
                        <path d="M 50 25 L 60 40 L 50 45 L 40 40 Z" fill="#ffffff"/>
                    </svg>
                </div>
                <div class="start-brand">
                    <div class="start-title">PEAK OS</div>
                    <div class="start-subtitle">Browser Environment</div>
                </div>
            </div>
            <div class="start-content">
                <div class="start-section">
                    <div class="start-section-title">üì± Applications</div>
                    <div class="start-grid">
                        <!-- ADDED DASHBOARD START ITEM -->
                        <div class="start-item" data-app="dashboard">
                            <div class="start-item-icon">üìä</div>
                            <div class="start-item-label">Dashboard</div>
                        </div>
                        <div class="start-item" data-app="hub">
                            <div class="start-item-icon">üåê</div>
                            <div class="start-item-label">Proxy Hub</div>
                        </div>
                        <div class="start-item" data-app="games">
                            <div class="start-item-icon">üéÆ</div>
                            <div class="start-item-label">Games</div>
                        </div>
                        <div class="start-item" data-app="styles">
                            <div class="start-item-icon">üé®</div>
                            <div class="start-item-label">Styles</div>
                        </div>
                        <div class="start-item" data-action="lock">
                            <div class="start-item-icon">üîí</div>
                            <div class="start-item-label">Lock</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Taskbar -->
        <div id="taskbar">
            <div class="taskbar-start">
                <button class="start-btn" id="start-btn">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <path d="M 20 90 L 40 50 L 50 60 L 60 40 L 80 90 Z" fill="currentColor"/>
                        <path d="M 50 25 L 60 40 L 50 45 L 40 40 Z" fill="#ffffff"/>
                    </svg>
                </button>
                <div class="search-taskbar">
                    <span>üîç</span>
                    <input type="text" id="taskbar-search" placeholder="Search apps, proxies, games...">
                    <div class="search-results" id="search-results"></div>
                </div>
            </div>
            
            <div class="taskbar-windows" id="taskbar-windows"></div>
            
            <div class="taskbar-end">
                <div class="taskbar-icon" id="lock-btn" title="Lock Screen">üîí</div>
                <div class="taskbar-clock" id="taskbar-clock">
                    <div class="clock-time">--:--</div>
                    <div class="clock-date">---</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div id="context-menu"></div>

    <script>
// SIMPLIFIED AND FIXED VERSION - NO IIFE WRAPPER

// Utility functions
const $ = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];

// Data management
const loadData = (key, def={}) => {
    try { return JSON.parse(localStorage.getItem('peakos-'+key) || JSON.stringify(def)); }
    catch { return def; }
};

const saveData = (key, data) => localStorage.setItem('peakos-'+key, JSON.stringify(data));

// Settings
let settings = loadData('settings', {
    theme: 'midnight',
    background: 'gradient-1',
    customBg: null,
    contrast: false,
    motion: false,
    font: false,
    performance: false
});

// Apply settings on load
document.body.className = `theme-${settings.theme}`;
document.body.classList.toggle('high-contrast', settings.contrast);
document.body.classList.toggle('reduced-motion', settings.motion);
document.body.classList.toggle('font-large', settings.font);
document.body.classList.toggle('performance-mode', settings.performance);

// Background
function applyBackground(bg, customUrl) {
    const el = $('#desktop-bg');
    el.className = '';
    if (bg.startsWith('gradient-')) {
        el.classList.add('bg-' + bg);
    } else if (bg === 'stars') {
        el.classList.add('bg-stars');
    } else if (bg === 'mesh') {
        el.classList.add('bg-mesh');
    } else if (bg === 'custom' && customUrl) {
        el.classList.add('bg-custom');
        el.style.backgroundImage = `url(${customUrl})`;
    }
}
applyBackground(settings.background, settings.customBg);

// Toast notifications
const toast = (title, msg, type='success') => {
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.innerHTML = `
        <div class="toast-icon">${type==='success'?'‚úì':'‚úï'}</div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-msg">${msg}</div>
        </div>
    `;
    document.body.appendChild(t);
    setTimeout(() => t.classList.add('show'), 10);
    setTimeout(() => {
        t.classList.remove('show');
        setTimeout(() => t.remove(), 300);
    }, 3000);
};

// Cursor management
const cursor = $('#cursor');
let cursorX = 0, cursorY = 0;
let ringX = 0, ringY = 0;

document.addEventListener('mousemove', e => {
    cursorX = e.clientX;
    cursorY = e.clientY;
    
    if (document.body.classList.contains('unlocked')) {
        ringX += (cursorX - ringX) * 0.15;
        ringY += (cursorY - ringY) * 0.15;
        cursor.style.left = ringX + 'px';
        cursor.style.top = ringY + 'px';
    }
});

document.addEventListener('mousedown', () => cursor.classList.add('click'));
document.addEventListener('mouseup', () => cursor.classList.remove('click'));

const bindHover = () => {
    $$('button,.desktop-icon,.start-item,.window-tab,.taskbar-icon,.window-btn,.context-item,.theme-card,.bg-card,.item-card,.search-result-item').forEach(el => {
        el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
        el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
    });
};

// UNLOCK SYSTEM - SIMPLIFIED AND FIXED
let unlockClicks = 0;
const unlockTrigger = $('#unlock-trigger');
const unlockStatus = $('#unlock-status');

if (unlockTrigger && unlockStatus) {
    unlockTrigger.addEventListener('click', function() {
        unlockClicks++;
        unlockStatus.textContent = `Click ${3-unlockClicks} more time${3-unlockClicks===1?'':'s'}`;
        
        console.log(`Unlock click ${unlockClicks}`); // Debug log
        
        if (unlockClicks >= 3) {
            console.log('Unlocking system...'); // Debug log
            $('#disguise').classList.add('hide');
            
            setTimeout(() => {
                document.body.classList.add('unlocked');
                $('#disguise').style.display = 'none';
                
                // Initialize the OS
                initBackground();
                bindHover();
                
                // Start cursor animation
                animateCursor();
                
                toast('Welcome to PeakOS', 'System ready');
                console.log('System unlocked!'); // Debug log
            }, 500);
        }
    });
}

// Cursor animation loop
function animateCursor() {
    if (document.body.classList.contains('unlocked')) {
        ringX += (cursorX - ringX) * 0.15;
        ringY += (cursorY - ringY) * 0.15;
        cursor.style.left = ringX + 'px';
        cursor.style.top = ringY + 'px';
    }
    requestAnimationFrame(animateCursor);
}

// Clock
function updateClock() {
    const now = new Date();
    const time = now.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
    const date = now.toLocaleDateString('en-US', {month: 'short', day: 'numeric'});
    
    const clockEl = $('#taskbar-clock');
    if (clockEl) {
        clockEl.querySelector('.clock-time').textContent = time;
        clockEl.querySelector('.clock-date').textContent = date;
    }
}
setInterval(updateClock, 1000);
updateClock();

// Start Menu
let startMenuOpen = false;
const startBtn = $('#start-btn');
const startMenu = $('#start-menu');

if (startBtn && startMenu) {
    startBtn.addEventListener('click', () => {
        startMenuOpen = !startMenuOpen;
        startMenu.classList.toggle('show', startMenuOpen);
    });
}

function closeStartMenu() {
    startMenuOpen = false;
    if (startMenu) startMenu.classList.remove('show');
}

document.addEventListener('click', (e) => {
    if (startMenuOpen && !e.target.closest('#start-menu') && !e.target.closest('#start-btn')) {
        closeStartMenu();
    }
});

// Lock button
const lockBtn = $('#lock-btn');
if (lockBtn) {
    lockBtn.addEventListener('click', () => {
        document.body.classList.remove('unlocked');
        $('#disguise').style.display = 'block';
        setTimeout(() => $('#disguise').classList.remove('hide'), 10);
        unlockClicks = 0;
        if (unlockStatus) unlockStatus.textContent = 'Click 3 times to unlock';
        closeAllWindows();
        closeStartMenu();
        toast('Locked', 'Screen locked');
    });
}

// Keyboard shortcuts
document.addEventListener('keydown', e => {
    if (e.ctrlKey && e.shiftKey && e.key === 'L') {
        e.preventDefault();
        if (document.body.classList.contains('unlocked')) {
            lockBtn.click();
        }
    }
});

// Background animation
function initBackground() {
    if (settings.performance) return;
    
    const canvas = $('#bg-canvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    let w, h;
    
    const resize = () => {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
    };
    resize();
    window.addEventListener('resize', resize);
    
    const particles = Array.from({length: 40}, () => ({
        x: Math.random() * w,
        y: Math.random() * h,
        vx: (Math.random() - 0.5) * 0.3,
        vy: (Math.random() - 0.5) * 0.3,
        r: Math.random() * 2 + 0.5
    }));
    
    const animate = () => {
        ctx.fillStyle = 'rgba(10,14,39,0.05)';
        ctx.fillRect(0, 0, w, h);
        
        particles.forEach(p => {
            p.x += p.vx;
            p.y += p.vy;
            
            if (p.x < 0 || p.x > w) p.vx *= -1;
            if (p.y < 0 || p.y > h) p.vy *= -1;
            
            ctx.fillStyle = `rgba(0,212,255,${0.3 + Math.random() * 0.2})`;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fill();
        });
        
        requestAnimationFrame(animate);
    };
    animate();
}

// Data
const PROXIES = [
    {id:'truffled', name:'Truffled', icon:'üîµ', links:[
        {t:'Main', u:'https://educational.radissontucson.com/'},
        {t:'Backup', u:'https://vacation.briaquaticcabinets.com/'}
    ]},
    {id:'overcloacked', name:'Overcloacked', icon:'‚ö°', links:[
        {t:'Primary', u:'https://d58o0iyi.beanweb.qzz.io.cdn.cloudflare.net/'}
    ]},
    {id:'fern', name:'Fern', icon:'üåø', links:[{t:'Main', u:'https://apple1.vandrekalenderen.dk/'}]},
    {id:'infamous', name:'Infamous', icon:'üî•', links:[{t:'Link 1', u:'https://team-anti-drugs.acgcotton.com/'}]},
    {id:'void', name:'Void', icon:'üåå', links:[{t:'EDU', u:'https://edu.ucecom-craiova.ro'}]},
    {id:'endis', name:'Endis', icon:'üí´', links:[{t:'Main', u:'https://endis.cute.lat/'}]},
    {id:'glint', name:'Glint', icon:'‚ú®', links:[{t:'Server 1', u:'https://aqua.bastaff.ru/'}]},
    {id:'demon', name:'Demon', icon:'üòà', links:[{t:'Main', u:'https://math.learn-math.space'}]},
    {id:'uptopia', name:'Uptopia', icon:'üèôÔ∏è', links:[{t:'Main', u:'https://iwantpizza.7geo7.ru'}]},
    {id:'bolt', name:'Bolt', icon:'‚ö°', links:[{t:'Main', u:'https://apple33.hicam.net'}]},
    {id:'uniub', name:'Uniub', icon:'üéì', links:[{t:'Main', u:'https://learnaboutbillclinton.bisblick.org/'}]},
    {id:'nautilus OS', name:'nautilus OS', icon:'üñ•Ô∏è', links:[{t:'Main', u:'https://lightspeedisass.graphicon.org/'}]}
];

const GAMES = [
    {id:'car-survival', icon:'üöó', name:'Car Survival 3D', cat:'Action',
     url:'https://rawcdn.githack.com/genizy/brainrot/main/car-survival-3d/index.html'},
    {id:'build-plane', icon:'‚úàÔ∏è', name:'Build a Plane', cat:'Adventure',
     url:'https://rawcdn.githack.com/genizy/brainrot/main/build-a-plane/index.html'},
    {id:'climbing', icon:'üßó', name:'Difficult Climbing', cat:'Adventure',
     url:'https://cdn.jsdelivr.net/gh/web-ports/adgac@main/index.html'},
    {id:'thirty-dollar', icon:'üóø', name:"Don't You Lecture Me", cat:'Music',
     url:'https://cdn.jsdelivr.net/gh/gn-math/assets@main/352/index.html'},
    {id:'soundboard', icon:'üîä', name:'Soundboard', cat:'Audio',
     url:'https://cdn.jsdelivr.net/gh/genizy/soundboard@main/index.html'},
    {id:'polytrack', icon:'üèéÔ∏è', name:'PolyTrack', cat:'Racing',
     url:'https://cdn.jsdelivr.net/gh/genizy/polytrack@latest/index.html'},
    {id:'fork-n-sausage', icon:'üç¥', name:'Fork N Sausage', cat:'Puzzle',
     url:'https://cdn.jsdelivr.net/gh/bubbls/youtube-playables@main/fork-n-sausage/index.html'},
    {id:'2048-merge', icon:'üî¢', name:'2048 Merge Run', cat:'Puzzle',
     url:'https://rawcdn.githack.com/genizy/brainrot/main/2048-merge-run/index.html'},
    {id:'attack-hole', icon:'‚ö´', name:'Attack Hole', cat:'Arcade',
     url:'https://cdn.jsdelivr.net/gh/bubbls/youtube-playables@8c0add17e99e4cbe9eaf6bb9e7487c3ad08c915a/attack-hole/index.html'},
    {id:'bazooka-boy', icon:'üí£', name:'Bazooka Boy', cat:'Action',
     url:'https://cdn.jsdelivr.net/gh/bubbls/youtube-playables@main/bazooka-boy/index.html'},
    {id:'basket-random', icon:'üèÄ', name:'Basket Random', cat:'Sports',
     url:'https://cdn.jsdelivr.net/gh/bubbls/ruffle@1520d90d7b2994737acd8f7a633d018f63c22ca7/index.html'},
    {id:'draw-line', icon:'‚úèÔ∏è', name:'Draw The Line', cat:'Puzzle',
     url:'https://cdn.jsdelivr.net/gh/bubbls/youtube-playables@main/draw-the-line/index.html'},
    {id:'escape-road', icon:'üöì', name:'Escape Road', cat:'Racing',
     url:'https://cdn.jsdelivr.net/gh/bubbls/escape-road@45b2d69c626dc365753f6922d2c48c4075683ef5/drive.google.com/escape%20road/index.html'},
    {id:'basket-bros', icon:'‚õπÔ∏è', name:'Basket Bros', cat:'Sports',
     url:'https://rawcdn.githack.com/genizy/brainrot/main/basket-bros/index.html'},
    {id:'evolving-bombs', icon:'üí•', name:'Evolving Bombs 3D', cat:'Action',
     url:'https://rawcdn.githack.com/genizy/brainrot/main/evolving-bombs-3d/index.html'},
    {id:'flip-master', icon:'ü§∏', name:'Flip Master', cat:'Sports',
     url:'https://rawcdn.githack.com/genizy/brainrot/main/flip-master/index.html'},
    {id:'giant-wanted', icon:'üëπ', name:'Giant Wanted', cat:'Action',
     url:'https://rawcdn.githack.com/genizy/brainrot/main/giant-wanted/index.html'}
];

// Window management
let windows = [];
let windowIdCounter = 0;
let activeWindowId = null;

const createWindow = (title, icon, type, onContentReady) => {
    const id = `win-${windowIdCounter++}`;
    
    const win = document.createElement('div');
    win.className = 'window';
    win.id = id;
    win.style.top = (50 + windows.length * 30) + 'px';
    win.style.left = (100 + windows.length * 30) + 'px';
    win.style.width = '1000px';
    win.style.height = '700px';
    
    const tabsHtml = type === 'browser' ? `
        <div class="window-tabs" id="tabs-${id}">
            <div class="window-tab active" data-tab-id="tab-0">
                <div class="window-tab-icon">${icon}</div>
                <div class="window-tab-title">${title}</div>
                <div class="window-tab-close">‚úï</div>
            </div>
            <button class="window-tab-new">+</button>
        </div>
    ` : '';
    
    win.innerHTML = `
        ${tabsHtml}
        <div class="window-titlebar">
            <div class="window-title">${title}</div>
            <div class="window-controls">
                <button class="window-btn minimize" title="Minimize">‚àí</button>
                <button class="window-btn maximize" title="Maximize">‚ñ°</button>
                <button class="window-btn close" title="Close">‚úï</button>
            </div>
        </div>
        <div class="tab-content active" id="content-${id}-0"></div>
    `;
    
    $('#windows-container').appendChild(win);
    
    // Controls
    win.querySelector('.close').addEventListener('click', () => closeWindow(id));
    win.querySelector('.minimize').addEventListener('click', () => minimizeWindow(id));
    win.querySelector('.maximize').addEventListener('click', () => toggleMaximize(id));
    
    // Focus on click
    win.addEventListener('mousedown', () => focusWindow(id));
    
    // Add to array
    windows.push({id, title, icon, type, minimized: false, tabs: [{title, icon, contentId: `content-${id}-0`}]});
    
    // Show window
    setTimeout(() => {
        win.classList.add('show');
        focusWindow(id);
        if (onContentReady) onContentReady($(`#content-${id}-0`));
    }, 50);
    
    updateTaskbarWindows();
    bindHover();
    
    return id;
};

const closeWindow = (id) => {
    const win = $(`#${id}`);
    if (win) {
        win.classList.remove('show');
        setTimeout(() => win.remove(), 200);
    }
    windows = windows.filter(w => w.id !== id);
    updateTaskbarWindows();
};

const minimizeWindow = (id) => {
    const win = $(`#${id}`);
    if (win) {
        win.classList.add('minimized');
        const winData = windows.find(w => w.id === id);
        if (winData) winData.minimized = true;
    }
    updateTaskbarWindows();
};

const restoreWindow = (id) => {
    const win = $(`#${id}`);
    if (win) {
        win.classList.remove('minimized');
        const winData = windows.find(w => w.id === id);
        if (winData) winData.minimized = false;
        focusWindow(id);
    }
    updateTaskbarWindows();
};

const toggleMaximize = (id) => {
    const win = $(`#${id}`);
    if (win) win.classList.toggle('maximized');
};

const focusWindow = (id) => {
    $$('.window').forEach(w => w.style.zIndex = 100);
    const win = $(`#${id}`);
    if (win) win.style.zIndex = 101;
    activeWindowId = id;
    updateTaskbarWindows();
};

const closeAllWindows = () => {
    windows.forEach(w => closeWindow(w.id));
};

// Taskbar windows
const updateTaskbarWindows = () => {
    const container = $('#taskbar-windows');
    if (!container) return;
    
    container.innerHTML = windows.map(w => `
        <div class="taskbar-window-btn ${w.id === activeWindowId && !w.minimized ? 'active' : ''}" data-id="${w.id}">
            <div class="taskbar-window-icon">${w.icon}</div>
            <div class="taskbar-window-title">${w.title}</div>
        </div>
    `).join('');
    
    $$('.taskbar-window-btn').forEach(btn => {
        const id = btn.dataset.id;
        btn.addEventListener('click', () => {
            const winData = windows.find(w => w.id === id);
            if (winData && winData.minimized) {
                restoreWindow(id);
            } else {
                focusWindow(id);
            }
        });
    });
    
    bindHover();
};

// Open apps
const openApp = (appId) => {
    if (appId === 'dashboard') openDashboardApp();
    else if (appId === 'hub') openProxyHub();
    else if (appId === 'games') openGamesApp();
    else if (appId === 'styles') openStylesApp();
    closeStartMenu();
};

const openDashboardApp = () => {
    createWindow('Dashboard', 'üìä', 'app', (content) => {
        content.className = 'tab-content active';
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div class="grid-title">Dashboard</div>
                    <div class="grid-subtitle">Welcome to PeakOS Browser Environment</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="item-card">
                        <div class="item-icon">üåê</div>
                        <div class="item-name">Proxy Hub</div>
                        <div class="item-desc">${PROXIES.length} proxies available</div>
                    </div>
                    <div class="item-card">
                        <div class="item-icon">üéÆ</div>
                        <div class="item-name">Game Library</div>
                        <div class="item-desc">${GAMES.length} games available</div>
                    </div>
                    <div class="item-card">
                        <div class="item-icon">‚öôÔ∏è</div>
                        <div class="item-name">System Info</div>
                        <div class="item-desc">PeakOS Browser Environment v1.0</div>
                    </div>
                </div>
                <div style="margin-top: 30px; padding: 20px; background: var(--bg3); border-radius: 12px; border: 1px solid var(--border);">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 10px;">Quick Tips:</div>
                    <div style="font-size: 12px; color: var(--txt2); line-height: 1.6;">
                        ‚Ä¢ Double-click desktop icons to open applications<br>
                        ‚Ä¢ Use the search bar in the taskbar to find anything<br>
                        ‚Ä¢ Right-click (or long-press) for context menus<br>
                        ‚Ä¢ Customize your experience in the Styles app<br>
                        ‚Ä¢ Press Ctrl+Shift+L to lock the screen
                    </div>
                </div>
            </div>
        `;
        
        $$('.item-card').forEach(card => {
            card.addEventListener('click', (e) => {
                const name = card.querySelector('.item-name').textContent;
                if (name === 'Proxy Hub') openApp('hub');
                else if (name === 'Game Library') openApp('games');
                else if (name === 'System Info') {
                    toast('System Info', 'PeakOS Browser Environment v1.0');
                }
            });
        });
        
        bindHover();
    });
};

const openProxyHub = () => {
    createWindow('Proxy Hub', 'üåê', 'app', (content) => {
        content.className = 'tab-content active';
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div class="grid-title">Proxy Hub</div>
                    <div class="grid-subtitle">${PROXIES.length} proxies available</div>
                </div>
                <div class="item-grid">
                    ${PROXIES.map(p => `
                        <div class="item-card" data-proxy-id="${p.id}">
                            <div class="item-icon">${p.icon}</div>
                            <div class="item-name">${p.name}</div>
                            <div class="item-desc">${p.links.length} link${p.links.length>1?'s':''}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        
        $$('.item-card[data-proxy-id]').forEach(card => {
            card.addEventListener('click', () => {
                const proxy = PROXIES.find(p => p.id === card.dataset.proxyId);
                if (proxy) openProxy(proxy);
            });
        });
        
        bindHover();
    });
};

const openGamesApp = () => {
    createWindow('Games', 'üéÆ', 'app', (content) => {
        content.className = 'tab-content active';
        content.innerHTML = `
            <div class="content-grid">
                <div class="grid-header">
                    <div class="grid-title">Game Library</div>
                    <div class="grid-subtitle">${GAMES.length} games available</div>
                </div>
                <div class="item-grid">
                    ${GAMES.map(g => `
                        <div class="item-card" data-game-id="${g.id}">
                            <div class="item-icon">${g.icon}</div>
                            <div class="item-name">${g.name}</div>
                            <div class="item-desc">${g.cat}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        
        $$('.item-card[data-game-id]').forEach(card => {
            card.addEventListener('click', () => {
                const game = GAMES.find(g => g.id === card.dataset.gameId);
                if (game) openGame(game, true);
            });
        });
        
        bindHover();
    });
};

const openStylesApp = () => {
    createWindow('Styles', 'üé®', 'app', (content) => {
        content.className = 'tab-content active';
        content.innerHTML = `
            <div class="styles-content">
                <div class="styles-section">
                    <div class="styles-section-title">üé® Themes</div>
                    <div class="theme-grid">
                        ${['midnight', 'sunset', 'forest', 'royal', 'cyberpunk', 'ocean'].map(t => `
                            <div class="theme-card ${settings.theme===t?'active':''}" data-theme="${t}">
                                <div class="theme-card-preview" style="background: ${getThemeGradient(t)};">${getThemeIcon(t)}</div>
                                <div class="theme-card-name">${t.charAt(0).toUpperCase()+t.slice(1)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="styles-section">
                    <div class="styles-section-title">üñºÔ∏è Backgrounds</div>
                    <div class="bg-grid">
                        ${['gradient-1', 'gradient-2', 'gradient-3', 'gradient-4', 'stars', 'mesh'].map(b => `
                            <div class="bg-card ${settings.background===b?'active':''}" data-bg="${b}">
                                <div class="bg-card-preview" style="${getBgPreview(b)}"></div>
                                <div class="bg-card-name">${getBgName(b)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="styles-section">
                    <div class="styles-section-title">üì§ Custom Background</div>
                    <label class="custom-bg-upload" for="bg-upload-${Date.now()}">
                        <input type="file" id="bg-upload-${Date.now()}" accept="image/*">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Choose Background Image</div>
                        <div class="upload-hint">Click to upload your own wallpaper</div>
                    </label>
                </div>
            </div>
        `;
        
        $$('.theme-card').forEach(card => {
            card.addEventListener('click', () => {
                const theme = card.dataset.theme;
                $$('.theme-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                document.body.className = document.body.className.replace(/theme-\w+/g, '');
                document.body.classList.add(`theme-${theme}`);
                settings.theme = theme;
                saveData('settings', settings);
                toast('Theme Changed', `Switched to ${theme}`);
            });
        });
        
        $$('.bg-card').forEach(card => {
            card.addEventListener('click', () => {
                const bg = card.dataset.bg;
                $$('.bg-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                settings.background = bg;
                settings.customBg = null;
                saveData('settings', settings);
                applyBackground(bg);
                toast('Background Changed', getBgName(bg));
            });
        });
        
        const uploadInput = content.querySelector('input[type="file"]');
        if (uploadInput) {
            uploadInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        settings.background = 'custom';
                        settings.customBg = ev.target.result;
                        saveData('settings', settings);
                        applyBackground('custom', ev.target.result);
                        toast('Custom Background', 'Your image has been set');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        bindHover();
    });
};

function getThemeGradient(theme) {
    const grads = {
        midnight: 'linear-gradient(135deg,#0a0e27,#1e2749)',
        sunset: 'linear-gradient(135deg,#1a0e0a,#3d2318)',
        forest: 'linear-gradient(135deg,#0a1a0e,#1e3d27)',
        royal: 'linear-gradient(135deg,#140a1a,#351e3d)',
        cyberpunk: 'linear-gradient(135deg,#0d0d1a,#272740)',
        ocean: 'linear-gradient(135deg,#0a141a,#18353d)'
    };
    return grads[theme] || grads.midnight;
}

function getThemeIcon(theme) {
    const icons = {midnight:'üåô', sunset:'üåÖ', forest:'üå≤', royal:'üëë', cyberpunk:'ü§ñ', ocean:'üåä'};
    return icons[theme] || 'üé®';
}

function getBgPreview(bg) {
    const previews = {
        'gradient-1': 'background: linear-gradient(135deg, #0a0e27 0%, #1e2749 100%)',
        'gradient-2': 'background: linear-gradient(135deg, #1a0e0a 0%, #3d2318 100%)',
        'gradient-3': 'background: linear-gradient(135deg, #0a1a0e 0%, #1e3d27 100%)',
        'gradient-4': 'background: linear-gradient(135deg, #140a1a 0%, #351e3d 100%)',
        'stars': 'background: #000',
        'mesh': 'background: radial-gradient(circle, rgba(0,212,255,0.2) 0%, transparent 50%), #0a0e27'
    };
    return previews[bg] || '';
}

function getBgName(bg) {
    const names = {
        'gradient-1': 'Blue Gradient',
        'gradient-2': 'Sunset Gradient',
        'gradient-3': 'Forest Gradient',
        'gradient-4': 'Purple Gradient',
        'stars': 'Starfield',
        'mesh': 'Mesh Glow'
    };
    return names[bg] || bg;
}

const openProxy = (proxy) => {
    if (proxy.links.length === 1) {
        openProxyUrl(proxy.name, proxy.icon, proxy.links[0].u);
    } else {
        showContextMenu(window.innerWidth/2, window.innerHeight/2, 
            proxy.links.map(link => ({
                icon: 'üîó',
                label: link.t,
                action: () => openProxyUrl(`${proxy.name} - ${link.t}`, proxy.icon, link.u)
            }))
        );
    }
};

const openProxyUrl = (title, icon, url) => {
    createWindow(title, icon, 'browser', (content) => {
        content.className = 'tab-content active';
        content.innerHTML = `
            <div class="content-frame">
                <div class="frame-loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading ${title}...</div>
                </div>
                <div class="frame-error">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div class="error-title">Failed to Load</div>
                    <div class="error-msg">This content couldn't be loaded. Try opening in a new tab.</div>
                    <button class="error-btn" onclick="window.open('${url}', '_blank')">Open in New Tab</button>
                </div>
                <iframe sandbox="allow-scripts allow-same-origin allow-pointer-lock allow-forms allow-popups allow-modals allow-top-navigation-by-user-activation" allow="autoplay; fullscreen"></iframe>
            </div>
        `;
        
        const iframe = content.querySelector('iframe');
        const loading = content.querySelector('.frame-loading');
        const error = content.querySelector('.frame-error');
        
        iframe.src = url;
        
        let loadTimeout = setTimeout(() => {
            loading.classList.add('hide');
            error.classList.add('show');
        }, 15000);
        
        iframe.addEventListener('load', () => {
            clearTimeout(loadTimeout);
            loading.classList.add('hide');
        });
        
        iframe.addEventListener('error', () => {
            clearTimeout(loadTimeout);
            loading.classList.add('hide');
            error.classList.add('show');
        });
    });
};

const openGame = (game, newWindow = false) => {
    openProxyUrl(game.name, game.icon, game.url);
};

// Context menu
const showContextMenu = (x, y, items) => {
    const menu = $('#context-menu');
    if (!menu) return;
    
    menu.innerHTML = items.map(item => `
        <div class="context-item" data-action="${items.indexOf(item)}">
            <div class="context-icon">${item.icon}</div>
            <div>${item.label}</div>
        </div>
    `).join('');
    
    menu.style.left = x + 'px';
    menu.style.top = y + 'px';
    menu.classList.add('show');
    
    $$('.context-item').forEach((el, idx) => {
        el.addEventListener('click', () => {
            items[idx].action();
            menu.classList.remove('show');
        });
    });
    
    setTimeout(() => {
        const hide = () => {
            menu.classList.remove('show');
            document.removeEventListener('click', hide);
        };
        document.addEventListener('click', hide);
    }, 100);
    
    bindHover();
};

// Desktop icons
$$('.desktop-icon[data-app]').forEach(icon => {
    icon.addEventListener('dblclick', () => {
        if (document.body.classList.contains('unlocked')) {
            openApp(icon.dataset.app);
        }
    });
});

// Start items
$$('.start-item[data-app]').forEach(item => {
    item.addEventListener('click', () => {
        if (document.body.classList.contains('unlocked')) {
            openApp(item.dataset.app);
            closeStartMenu();
        }
    });
});

$$('.start-item[data-action]').forEach(item => {
    item.addEventListener('click', () => {
        if (item.dataset.action === 'lock' && lockBtn) {
            lockBtn.click();
        }
        closeStartMenu();
    });
});

// Initial hover binding
bindHover();

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    console.log('Page loaded - ready to unlock');
    updateClock();
    
    // Add click counter reset if user waits too long
    setInterval(() => {
        if (unlockClicks > 0 && unlockClicks < 3) {
            unlockClicks = 0;
            if (unlockStatus) {
                unlockStatus.textContent = 'Click 3 times to unlock';
            }
        }
    }, 10000); // Reset after 10 seconds of inactivity
});

    </script>
</body>
</html>
